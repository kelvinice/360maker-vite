/**
 * Minified by jsDelivr using Terser v5.15.0.
 * Original file: /npm/photo-sphere-viewer@4.7.3/dist/plugins/markers.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
/*!
* Photo Sphere Viewer 4.7.3
* @copyright 2014-2015 Jérémy Heleine
* @copyright 2015-2022 Damien "Mistic" Sorel
* @licence MIT (https://opensource.org/licenses/MIT)
*/
!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports,require("three"),require("photo-sphere-viewer")):"function"==typeof define&&define.amd?define(["exports","three","photo-sphere-viewer"],i):i(((t="undefined"!=typeof globalThis?globalThis:t||self).PhotoSphereViewer=t.PhotoSphereViewer||{},t.PhotoSphereViewer.MarkersPlugin={}),t.THREE,t.PhotoSphereViewer)}(this,(function(t,i,e){"use strict";function s(){return s=Object.assign||function(t){for(var i=1;i<arguments.length;i++){var e=arguments[i];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])}return t},s.apply(this,arguments)}function r(t,i){t.prototype=Object.create(i.prototype),t.prototype.constructor=t,o(t,i)}function o(t,i){return o=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t},o(t,i)}function n(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var h='<svg xmlns="http://www.w3.org/2000/svg" viewBox="9 9 81 81"><path fill="currentColor" d="M37.5 90S9.9 51.9 9.9 36.6 22.2 9 37.5 9s27.6 12.4 27.6 27.6S37.5 90 37.5 90zm0-66.3c-6.1 0-11 4.9-11 11s4.9 11 11 11 11-4.9 11-11-4.9-11-11-11zM86.7 55H70c-1.8 0-3.3-1.5-3.3-3.3s1.5-3.3 3.3-3.3h16.7c1.8 0 3.3 1.5 3.3 3.3S88.5 55 86.7 55zm0-25h-15a3.3 3.3 0 0 1-3.3-3.3c0-1.8 1.5-3.3 3.3-3.3h15c1.8 0 3.3 1.5 3.3 3.3 0 1.8-1.5 3.3-3.3 3.3zM56.5 73h30c1.8 0 3.3 1.5 3.3 3.3 0 1.8-1.5 3.3-3.3 3.3h-30a3.3 3.3 0 0 1-3.3-3.3 3.2 3.2 0 0 1 3.3-3.3z"/>\x3c!--Created by Rohith M S from the Noun Project--\x3e</svg>\n',a={MARKER_VISIBILITY:"marker-visibility",GOTO_MARKER_DONE:"goto-marker-done",LEAVE_MARKER:"leave-marker",OVER_MARKER:"over-marker",RENDER_MARKERS_LIST:"render-markers-list",SELECT_MARKER:"select-marker",SELECT_MARKER_LIST:"select-marker-list",UNSELECT_MARKER:"unselect-marker",HIDE_MARKERS:"hide-markers",SET_MARKERS:"set-markers",SHOW_MARKERS:"show-markers"},l="click",p="hover",c="http://www.w3.org/2000/svg",g="psvMarker",u="marker",d="markersList",f=e.utils.dasherize(g),v=function(t,i){return'\n<div class="psv-panel-menu psv-panel-menu--stripped">\n  <h1 class="psv-panel-menu-title">'+h+" "+i+'</h1>\n  <ul class="psv-panel-menu-list">\n    '+t.map((function(t){return"\n    <li data-"+f+'="'+t.config.id+'" class="psv-panel-menu-item" tabindex="0">\n      '+("image"===t.type?'<span class="psv-panel-menu-item-icon"><img src="'+t.config.image+'"/></span>':"")+'\n      <span class="psv-panel-menu-item-label">'+t.getListContent()+"</span>\n    </li>\n    "})).join("")+"\n  </ul>\n</div>\n"};function k(t,i,s){var r=t[0],o=t[1],n=i[0],h=i[1],a=e.utils.greatArcDistance(t,i),l=Math.sin((1-s)*a)/Math.sin(a),p=Math.sin(s*a)/Math.sin(a),c=l*Math.cos(o)*Math.cos(r)+p*Math.cos(h)*Math.cos(n),g=l*Math.cos(o)*Math.sin(r)+p*Math.cos(h)*Math.sin(n),u=l*Math.sin(o)+p*Math.sin(h);return[Math.atan2(g,c),Math.atan2(u,Math.sqrt(c*c+g*g))]}var m={image:"image",imageLayer:"imageLayer",html:"html",polygonPx:"polygonPx",polygonRad:"polygonRad",polylinePx:"polylinePx",polylineRad:"polylineRad",square:"square",rect:"rect",circle:"circle",ellipse:"ellipse",path:"path"},y=function(){function t(s,r){if(!s.id)throw new e.PSVError("missing marker id");if(this.psv=r,this.id=s.id,this.type=t.getType(s,!1),this.visible=!0,this.$el=null,this.config={},this.data=void 0,this.tooltip=null,this.props={dynamicSize:!1,anchor:null,visible:!1,staticTooltip:!1,position:null,position2D:null,positions3D:null,width:null,height:null,def:null},this.loader=null,this.is3d()&&(this.loader=new i.TextureLoader,this.psv.config.withCredentials&&this.loader.setWithCredentials(!0),this.psv.config.requestHeaders&&"object"==typeof this.psv.config.requestHeaders&&this.loader.setRequestHeader(this.psv.config.requestHeaders)),this.isNormal())this.$el=document.createElement("div");else if(this.isPolygon())this.$el=document.createElementNS(c,"polygon");else if(this.isPolyline())this.$el=document.createElementNS(c,"polyline");else if(this.isSvg()){var o="square"===this.type?"rect":this.type;this.$el=document.createElementNS(c,o)}this.is3d()||(this.$el.id="psv-marker-"+this.id,this.$el.psvMarker=this),this.update(s)}var r=t.prototype;return r.destroy=function(){delete this.$el.psvMarker,delete this.$el,delete this.config,delete this.props,delete this.psv},r.is3d=function(){return this.type===m.imageLayer},r.isNormal=function(){return this.type===m.image||this.type===m.html},r.isPoly=function(){return this.isPolygon()||this.isPolyline()},r.isPolyPx=function(){return this.type===m.polygonPx||this.type===m.polylinePx},r.isPolyRad=function(){return this.type===m.polygonRad||this.type===m.polylineRad},r.isPolygon=function(){return this.type===m.polygonPx||this.type===m.polygonRad},r.isPolyline=function(){return this.type===m.polylinePx||this.type===m.polylineRad},r.isSvg=function(){return this.type===m.square||this.type===m.rect||this.type===m.circle||this.type===m.ellipse||this.type===m.path},r.getScale=function(t,s){if(!this.config.scale)return 1;if("function"==typeof this.config.scale)return this.config.scale(t,s);var r=1;if(Array.isArray(this.config.scale.zoom)){var o=this.config.scale.zoom;r*=o[0]+(o[1]-o[0])*e.CONSTANTS.EASINGS.inQuad(t/100)}if(Array.isArray(this.config.scale.longitude)){var n=this.config.scale.longitude,h=i.MathUtils.degToRad(this.psv.prop.hFov)/2,a=Math.abs(e.utils.getShortestArc(this.props.position.longitude,s.longitude));r*=n[1]+(n[0]-n[1])*e.CONSTANTS.EASINGS.outQuad(Math.max(0,(h-a)/h))}return r},r.getListContent=function(){return this.config.listContent?this.config.listContent:this.config.tooltip.content?this.config.tooltip.content:this.config.html?this.config.html:this.id},r.showTooltip=function(t){if(this.props.visible&&this.config.tooltip.content&&this.props.position2D){var i=s({},this.config.tooltip,{data:this});if(this.isPoly())if(i.box={width:2*this.psv.tooltip.size.arrow,height:2*this.psv.tooltip.size.arrow},t){var r=e.utils.getPosition(this.psv.container);i.top=t.clientY-r.top-this.psv.tooltip.size.arrow/2,i.left=t.clientX-r.left-this.psv.tooltip.size.arrow}else i.top=this.props.position2D.y,i.left=this.props.position2D.x;else i.top=this.props.position2D.y,i.left=this.props.position2D.x,i.box={width:this.props.width,height:this.props.height};this.tooltip?this.tooltip.move(i):this.tooltip=this.psv.tooltip.create(i)}},r.refreshTooltip=function(){this.tooltip&&this.showTooltip()},r.hideTooltip=function(){this.tooltip&&(this.tooltip.hide(),this.tooltip=null)},r.update=function(i){var s,r=t.getType(i,!0);if(void 0!==r&&r!==this.type)throw new e.PSVError("cannot change marker type");(e.utils.deepmerge(this.config,i),"string"==typeof this.config.tooltip&&(this.config.tooltip={content:this.config.tooltip}),this.config.tooltip||(this.config.tooltip={}),this.config.tooltip.trigger||(this.config.tooltip.trigger=p),this.data=this.config.data,this.visible=!1!==this.config.visible,this.is3d())||(this.isNormal()?this.$el.className="psv-marker psv-marker--normal":this.$el.setAttribute("class","psv-marker psv-marker--svg"),this.config.className&&e.utils.addClasses(this.$el,this.config.className),this.config.tooltip&&this.$el.classList.add("psv-marker--has-tooltip"),this.config.content&&this.$el.classList.add("psv-marler--has-content"),this.$el.style.opacity=null!=(s=this.config.opacity)?s:1,this.config.style&&e.utils.deepmerge(this.$el.style,this.config.style));this.props.anchor=e.utils.parsePosition(this.config.anchor),this.config.scale&&("number"==typeof this.config.scale&&(e.utils.logWarn("Single value marker scale is deprecated, please use an array of two values."),this.config.scale={zoom:[0,this.config.scale]}),Array.isArray(this.config.scale)&&(this.config.scale={zoom:this.config.scale})),this.isNormal()?this.__updateNormal():this.isPoly()?this.__updatePoly():this.isSvg()?this.__updateSvg():this.is3d()&&this.__update3d()},r.__updateNormal=function(){if(!e.utils.isExtendedPosition(this.config))throw new e.PSVError("missing marker position, latitude/longitude or x/y");if(this.config.image&&(!this.config.width||!this.config.height))throw new e.PSVError("missing marker width/height");this.config.width&&this.config.height?(this.props.dynamicSize=!1,this.props.width=this.config.width,this.props.height=this.config.height,this.$el.style.width=this.config.width+"px",this.$el.style.height=this.config.height+"px"):this.props.dynamicSize=!0,this.config.image?(this.props.def=this.config.image,this.$el.style.backgroundImage="url("+this.config.image+")"):this.config.html&&(this.props.def=this.config.html,this.$el.innerHTML=this.config.html),this.$el.style.transformOrigin=100*this.props.anchor.x+"% "+100*this.props.anchor.y+"%",this.props.position=this.psv.dataHelper.cleanPosition(this.config),this.props.positions3D=[this.psv.dataHelper.sphericalCoordsToVector3(this.props.position)]},r.__updateSvg=function(){var t=this;if(!e.utils.isExtendedPosition(this.config))throw new e.PSVError("missing marker position, latitude/longitude or x/y");switch(this.props.dynamicSize=!0,this.type){case m.square:this.props.def={x:0,y:0,width:this.config.square,height:this.config.square};break;case m.rect:Array.isArray(this.config.rect)?this.props.def={x:0,y:0,width:this.config.rect[0],height:this.config.rect[1]}:this.props.def={x:0,y:0,width:this.config.rect.width,height:this.config.rect.height};break;case m.circle:this.props.def={cx:this.config.circle,cy:this.config.circle,r:this.config.circle};break;case m.ellipse:Array.isArray(this.config.ellipse)?this.props.def={cx:this.config.ellipse[0],cy:this.config.ellipse[1],rx:this.config.ellipse[0],ry:this.config.ellipse[1]}:this.props.def={cx:this.config.ellipse.rx,cy:this.config.ellipse.ry,rx:this.config.ellipse.rx,ry:this.config.ellipse.ry};break;case m.path:this.props.def={d:this.config.path}}e.utils.each(this.props.def,(function(i,e){t.$el.setAttributeNS(null,e,i)})),this.config.svgStyle?e.utils.each(this.config.svgStyle,(function(i,s){t.$el.setAttributeNS(null,e.utils.dasherize(s),i)})):this.$el.setAttributeNS(null,"fill","rgba(0,0,0,0.5)"),this.props.position=this.psv.dataHelper.cleanPosition(this.config),this.props.positions3D=[this.psv.dataHelper.sphericalCoordsToVector3(this.props.position)]},r.__updatePoly=function(){var t=this;this.props.dynamicSize=!0,this.config.svgStyle?(e.utils.each(this.config.svgStyle,(function(i,s){t.$el.setAttributeNS(null,e.utils.dasherize(s),i)})),this.isPolyline()&&!this.config.svgStyle.fill&&this.$el.setAttributeNS(null,"fill","none")):this.isPolygon()?this.$el.setAttributeNS(null,"fill","rgba(0,0,0,0.5)"):this.isPolyline()&&(this.$el.setAttributeNS(null,"fill","none"),this.$el.setAttributeNS(null,"stroke","rgb(0,0,0)"));var i=this.config.polygonPx||this.config.polygonRad||this.config.polylinePx||this.config.polylineRad;if(!Array.isArray(i[0]))for(var s=0;s<i.length;s++)i.splice(s,2,[i[s],i[s+1]]);this.isPolyPx()?this.props.def=i.map((function(i){var e=t.psv.dataHelper.textureCoordsToSphericalCoords({x:i[0],y:i[1]});return[e.longitude,e.latitude]})):this.props.def=i.map((function(t){return[e.utils.parseAngle(t[0]),e.utils.parseAngle(t[1],!0)]}));var r=this.isPolygon()?function(t){for(var i=[t[0]],s=0,r=1;r<t.length;r++){var o=t[r-1][0]-t[r][0];o>Math.PI?s+=1:o<-Math.PI&&(s-=1),i.push([t[r][0]+2*s*Math.PI,t[r][1]])}var n=i.reduce((function(t,i){return[t[0]+i[0],t[1]+i[1]]}));return[e.utils.parseAngle(n[0]/t.length),n[1]/t.length]}(this.props.def):function(t){for(var i=0,s=[],r=0;r<t.length-1;r++){var o=e.utils.greatArcDistance(t[r],t[r+1])*e.CONSTANTS.SPHERE_RADIUS;s.push(o),i+=o}for(var n=0,h=0;h<t.length-1;h++){if(n+s[h]>i/2){var a=(i/2-n)/s[h];return k(t[h],t[h+1],a)}n+=s[h]}return t[Math.round(t.length/2)]}(this.props.def);this.props.position={longitude:r[0],latitude:r[1]},this.props.positions3D=this.props.def.map((function(i){return t.psv.dataHelper.sphericalCoordsToVector3({longitude:i[0],latitude:i[1]})}))},r.__update3d=function(){var t=this;if(!this.config.width||!this.config.height)throw new e.PSVError("missing marker width/height");if(this.props.dynamicSize=!1,this.props.width=this.config.width,this.props.height=this.config.height,this.props.position=this.psv.dataHelper.cleanPosition(this.config),this.props.positions3D=[this.psv.dataHelper.sphericalCoordsToVector3(this.props.position)],this.type===m.imageLayer){if(!this.$el){var s,r,o=new i.MeshBasicMaterial({transparent:!0,opacity:null!=(s=this.config.opacity)?s:1,depthTest:!1}),n=new i.PlaneGeometry(1,1),h=new i.Mesh(n,o);h.userData=((r={}).psvMarker=this,r),this.$el=(new i.Group).add(h),Object.defineProperty(this.$el,"visible",{enumerable:!0,get:function(){return this.children[0].userData.psvMarker.visible},set:function(t){this.children[0].userData.psvMarker.visible=t}})}switch(this.props.def!==this.config.imageLayer&&(this.psv.config.requestHeaders&&"function"==typeof this.psv.config.requestHeaders&&this.loader.setRequestHeader(this.psv.config.requestHeaders(this.config.imageLayer)),this.$el.children[0].material.map=this.loader.load(this.config.imageLayer,(function(i){i.anisotropy=4,t.psv.needsUpdate()})),this.props.def=this.config.imageLayer),this.$el.children[0].position.set(this.props.anchor.x-.5,this.props.anchor.y-.5,0),this.$el.position.copy(this.props.positions3D[0]),this.config.orientation){case"horizontal":this.$el.lookAt(0,this.$el.position.y,0),this.$el.rotateX(this.props.position.latitude<0?-Math.PI/2:Math.PI/2);break;case"vertical-left":this.$el.lookAt(0,0,0),this.$el.rotateY(.4*-Math.PI);break;case"vertical-right":this.$el.lookAt(0,0,0),this.$el.rotateY(.4*Math.PI);break;default:this.$el.lookAt(0,0,0)}this.$el.scale.set(this.config.width/100,this.config.height/100,1)}},t.getType=function(t,i){void 0===i&&(i=!1);var s=[];if(e.utils.each(m,(function(i){t[i]&&s.push(i)})),0===s.length&&!i)throw new e.PSVError("missing marker content, either "+Object.keys(m).join(", "));if(s.length>1)throw new e.PSVError("multiple marker content, either "+Object.keys(m).join(", "));return s[0]},t}(),M=function(t){function i(i){var e;return(e=t.call(this,i,"psv-button--hover-scale psv-markers-button",!0)||this).plugin=e.psv.getPlugin("markers"),e.plugin&&(e.plugin.on(a.SHOW_MARKERS,n(e)),e.plugin.on(a.HIDE_MARKERS,n(e)),e.toggleActive(!0)),e.hide(),e}r(i,t);var e=i.prototype;return e.destroy=function(){this.plugin&&(this.plugin.off(a.SHOW_MARKERS,this),this.plugin.off(a.HIDE_MARKERS,this)),t.prototype.destroy.call(this)},e.isSupported=function(){return!!this.plugin},e.handleEvent=function(t){switch(t.type){case a.SHOW_MARKERS:this.toggleActive(!0);break;case a.HIDE_MARKERS:this.toggleActive(!1)}},e.onClick=function(){this.plugin.prop.visible?this.plugin.hide():this.plugin.show()},i}(e.AbstractButton);M.id="markers",M.icon='<svg xmlns="http://www.w3.org/2000/svg" viewBox="10 9 81 81"><path fill="currentColor" d="M50.5 90S22.9 51.9 22.9 36.6 35.2 9 50.5 9s27.6 12.4 27.6 27.6S50.5 90 50.5 90zm0-66.3c-6.1 0-11 4.9-11 11s4.9 11 11 11 11-4.9 11-11-4.9-11-11-11z"/>\x3c!--Created by Rohith M S from the Noun Project--\x3e</svg>\n';var E=function(t){function i(i){var s;return(s=t.call(this,i,"psv-button--hover-scale psv-markers-list-button",!0)||this).plugin=s.psv.getPlugin("markers"),s.plugin&&(s.psv.on(e.CONSTANTS.EVENTS.OPEN_PANEL,n(s)),s.psv.on(e.CONSTANTS.EVENTS.CLOSE_PANEL,n(s))),s.hide(),s}r(i,t);var s=i.prototype;return s.destroy=function(){this.psv.off(e.CONSTANTS.EVENTS.OPEN_PANEL,this),this.psv.off(e.CONSTANTS.EVENTS.CLOSE_PANEL,this),t.prototype.destroy.call(this)},s.isSupported=function(){return!!this.plugin},s.handleEvent=function(t){switch(t.type){case e.CONSTANTS.EVENTS.OPEN_PANEL:this.toggleActive(t.args[0]===d);break;case e.CONSTANTS.EVENTS.CLOSE_PANEL:this.toggleActive(!1)}},s.onClick=function(){this.plugin.toggleMarkersList()},i}(e.AbstractButton);E.id="markersList",E.icon=h,e.DEFAULTS.lang[M.id]="Markers",e.DEFAULTS.lang[E.id]="Markers list",e.registerButton(M,"caption:left"),e.registerButton(E,"caption:left");var S=function(t){function o(i,r){var o;return(o=t.call(this,i)||this).markers={},o.prop={visible:!0,currentMarker:null,hoveringMarker:null,stopObserver:null},o.config=s({clickEventOnMarker:!1},r),!1!==(null==r?void 0:r.listButton)&&!1!==(null==r?void 0:r.hideButton)||e.utils.logWarn("MarkersPlugin: listButton and hideButton options are deprecated. Please define the global navbar options according to your needs."),o.container=document.createElement("div"),o.container.className="psv-markers",o.container.style.cursor=o.psv.config.mousemove?"move":"default",o.svgContainer=document.createElementNS(c,"svg"),o.svgContainer.setAttribute("class","psv-markers-svg-container"),o.container.appendChild(o.svgContainer),o.container.addEventListener("mouseenter",n(o),!0),o.container.addEventListener("mouseleave",n(o),!0),o.container.addEventListener("mousemove",n(o),!0),o.container.addEventListener("contextmenu",n(o)),o}r(o,t);var h=o.prototype;return h.init=function(){var i=this;t.prototype.init.call(this),this.psv.container.appendChild(this.container),this.psv.on(e.CONSTANTS.EVENTS.CLICK,this),this.psv.on(e.CONSTANTS.EVENTS.DOUBLE_CLICK,this),this.psv.on(e.CONSTANTS.EVENTS.RENDER,this),this.psv.on(e.CONSTANTS.EVENTS.CONFIG_CHANGED,this),this.psv.once(e.CONSTANTS.EVENTS.READY,(function(){i.config.markers&&(i.setMarkers(i.config.markers),delete i.config.markers)}))},h.destroy=function(){var i,s;this.clearMarkers(!1),null==(i=(s=this.prop).stopObserver)||i.call(s),this.psv.off(e.CONSTANTS.EVENTS.CLICK,this),this.psv.off(e.CONSTANTS.EVENTS.DOUBLE_CLICK,this),this.psv.off(e.CONSTANTS.EVENTS.RENDER,this),this.psv.off(e.CONSTANTS.EVENTS.CONFIG_CHANGED,this),this.psv.container.removeChild(this.container),delete this.svgContainer,delete this.markers,delete this.container,t.prototype.destroy.call(this)},h.handleEvent=function(t){switch(t.type){case"mouseenter":this.__onMouseEnter(t,this.__getTargetMarker(t.target));break;case"mouseleave":this.__onMouseLeave(t,this.__getTargetMarker(t.target));break;case"mousemove":this.__onMouseMove(t,this.__getTargetMarker(t.target));break;case"contextmenu":t.preventDefault();break;case e.CONSTANTS.EVENTS.CLICK:this.__onClick(t,t.args[0],!1);break;case e.CONSTANTS.EVENTS.DOUBLE_CLICK:this.__onClick(t,t.args[0],!0);break;case e.CONSTANTS.EVENTS.RENDER:this.renderMarkers();break;case e.CONSTANTS.OBJECT_EVENTS.ENTER_OBJECT:this.__onMouseEnter(t.detail.originalEvent,t.detail.data);break;case e.CONSTANTS.OBJECT_EVENTS.LEAVE_OBJECT:this.__onMouseLeave(t.detail.originalEvent,t.detail.data);break;case e.CONSTANTS.OBJECT_EVENTS.HOVER_OBJECT:this.__onMouseMove(t.detail.originalEvent,t.detail.data);break;case e.CONSTANTS.EVENTS.CONFIG_CHANGED:this.container.style.cursor=this.psv.config.mousemove?"move":"default"}},h.show=function(){this.prop.visible=!0,this.renderMarkers(),this.trigger(a.SHOW_MARKERS)},h.hide=function(){this.prop.visible=!1,this.renderMarkers(),this.trigger(a.HIDE_MARKERS)},h.toggleAllTooltips=function(){this.prop.showAllTooltips?this.hideAllTooltips():this.showAllTooltips()},h.showAllTooltips=function(){this.prop.showAllTooltips=!0,e.utils.each(this.markers,(function(t){t.props.staticTooltip=!0,t.showTooltip()}))},h.hideAllTooltips=function(){this.prop.showAllTooltips=!1,e.utils.each(this.markers,(function(t){t.props.staticTooltip=!1,t.hideTooltip()}))},h.getNbMarkers=function(){return Object.keys(this.markers).length},h.getMarkers=function(){return Object.values(this.markers)},h.addMarker=function(t,i){if(void 0===i&&(i=!0),this.markers[t.id])throw new e.PSVError('marker "'+t.id+'" already exists');var s=new y(t,this.psv);return s.isNormal()?this.container.appendChild(s.$el):s.isPoly()||s.isSvg()?this.svgContainer.appendChild(s.$el):s.is3d()&&this.psv.renderer.scene.add(s.$el),this.markers[s.id]=s,i&&(this.renderMarkers(),this.__refreshUi(),this.__checkObjectsObserver(),this.trigger(a.SET_MARKERS,this.getMarkers())),s},h.getMarker=function(t){var i="object"==typeof t?t.id:t;if(!this.markers[i])throw new e.PSVError('cannot find marker "'+i+'"');return this.markers[i]},h.getCurrentMarker=function(){return this.prop.currentMarker},h.updateMarker=function(t,i){void 0===i&&(i=!0);var e=this.getMarker(t.id);return e.update(t),i&&(this.renderMarkers(),this.__refreshUi(),e.is3d()&&this.psv.needsUpdate(),this.trigger(a.SET_MARKERS,this.getMarkers())),e},h.removeMarker=function(t,i){void 0===i&&(i=!0);var e=this.getMarker(t);e.isNormal()?this.container.removeChild(e.$el):e.isPoly()||e.isSvg()?this.svgContainer.removeChild(e.$el):e.is3d()&&(this.psv.renderer.scene.remove(e.$el),this.psv.needsUpdate()),this.prop.hoveringMarker===e&&(this.prop.hoveringMarker=null),this.prop.currentMarker===e&&(this.prop.currentMarker=null),e.hideTooltip(),e.destroy(),delete this.markers[e.id],i&&(this.__refreshUi(),this.__checkObjectsObserver(),this.trigger(a.SET_MARKERS,this.getMarkers()))},h.removeMarkers=function(t,i){var e=this;void 0===i&&(i=!0),t.forEach((function(t){return e.removeMarker(t,!1)})),i&&(this.__refreshUi(),this.__checkObjectsObserver(),this.trigger(a.SET_MARKERS,this.getMarkers()))},h.setMarkers=function(t,i){var s=this;void 0===i&&(i=!0),this.clearMarkers(!1),e.utils.each(t,(function(t){return s.addMarker(t,!1)})),i&&(this.renderMarkers(),this.__refreshUi(),this.__checkObjectsObserver(),this.trigger(a.SET_MARKERS,this.getMarkers()))},h.clearMarkers=function(t){var i=this;void 0===t&&(t=!0),e.utils.each(this.markers,(function(t){return i.removeMarker(t,!1)})),t&&(this.renderMarkers(),this.__refreshUi(),this.__checkObjectsObserver(),this.trigger(a.SET_MARKERS,this.getMarkers()))},h.gotoMarker=function(t,i){var e=this,r=this.getMarker(t);return this.psv.animate(s({},r.props.position,{speed:i})).then((function(){e.trigger(a.GOTO_MARKER_DONE,r)}))},h.hideMarker=function(t){this.toggleMarker(t,!1)},h.showMarker=function(t){this.toggleMarker(t,!0)},h.showMarkerTooltip=function(t){var i=this.getMarker(t);i.props.staticTooltip=!0,i.showTooltip()},h.hideMarkerTooltip=function(t){var i=this.getMarker(t);i.props.staticTooltip=!1,i.hideTooltip()},h.toggleMarker=function(t,i){void 0===i&&(i=null);var e=this.getMarker(t);e.visible=null===i?!e.visible:i,e.is3d()?this.psv.needsUpdate():this.renderMarkers()},h.showMarkerPanel=function(t){var i,e=this.getMarker(t);null!=e&&null!=(i=e.config)&&i.content?this.psv.panel.show({id:u,content:e.config.content}):this.psv.panel.hide(u)},h.toggleMarkersList=function(){this.psv.panel.prop.contentId===d?this.hideMarkersList():this.showMarkersList()},h.showMarkersList=function(){var t=this,i=[];e.utils.each(this.markers,(function(t){t.visible&&!t.config.hideList&&i.push(t)})),i=this.change(a.RENDER_MARKERS_LIST,i),this.psv.panel.show({id:d,content:v(i,this.psv.config.lang[M.id]),noMargin:!0,clickHandler:function(i){var s=i.target?e.utils.getClosest(i.target,"li"):void 0,r=s?s.dataset.psvMarker:void 0;if(r){var o=t.getMarker(r);t.trigger(a.SELECT_MARKER_LIST,o),t.gotoMarker(o,1e3),t.hideMarkersList()}}})},h.hideMarkersList=function(){this.psv.panel.hide(d)},h.renderMarkers=function(){var t=this,i=this.psv.getZoomLevel(),s=this.psv.getPosition();e.utils.each(this.markers,(function(r){var o,n=t.prop.visible&&r.visible,h=null;if(n&&r.is3d())h=t.__getMarkerPosition(r),n=t.__isMarkerVisible(r,h);else if(n&&r.isPoly()){var p=t.__getPolyPositions(r);if(n=p.length>(r.isPolygon()?2:1)){h=t.__getMarkerPosition(r);var c=p.map((function(t){return t.x-h.x+","+(t.y-h.y)})).join(" ");r.$el.setAttributeNS(null,"points",c),r.$el.setAttributeNS(null,"transform","translate("+h.x+" "+h.y+")")}}else if(n&&(r.props.dynamicSize&&t.__updateMarkerSize(r),h=t.__getMarkerPosition(r),n=t.__isMarkerVisible(r,h))){var g=r.getScale(i,s);if(r.isSvg()){var u=h.x+r.props.width*r.props.anchor.x*(1-g),d=h.y+r.props.height*r.props.anchor.y*(1-g);r.$el.setAttributeNS(null,"transform","translate("+u+", "+d+") scale("+g+", "+g+")")}else r.$el.style.transform="translate3D("+h.x+"px, "+h.y+"px, 0px) scale("+g+", "+g+")"}o=r.props.visible!==n,r.props.visible=n,r.props.position2D=n?h:null,r.is3d()||e.utils.toggleClass(r.$el,"psv-marker--visible",n),n?r.props.staticTooltip?r.showTooltip():r.config.tooltip.trigger===l||r===t.prop.hoveringMarker&&!r.isPoly()?r.refreshTooltip():r!==t.prop.hoveringMarker&&r.hideTooltip():r.hideTooltip(),o&&t.trigger(a.MARKER_VISIBILITY,r,n)}))},h.__isMarkerVisible=function(t,i){return t.props.positions3D[0].dot(this.psv.prop.direction)>0&&i.x+t.props.width>=0&&i.x-t.props.width<=this.psv.prop.size.width&&i.y+t.props.height>=0&&i.y-t.props.height<=this.psv.prop.size.height},h.__updateMarkerSize=function(t){var i;t.$el.classList.add("psv-marker--transparent"),t.isSvg()?(i=t.$el.getAttributeNS(null,"transform"),t.$el.removeAttributeNS(null,"transform")):(i=t.$el.style.transform,t.$el.style.transform="");var e=t.$el.getBoundingClientRect();t.props.width=e.width,t.props.height=e.height,t.$el.classList.remove("psv-marker--transparent"),i&&(t.isSvg()?t.$el.setAttributeNS(null,"transform",i):t.$el.style.transform=i),t.props.dynamicSize=!1},h.__getMarkerPosition=function(t){if(t.isPoly())return this.psv.dataHelper.sphericalCoordsToViewerCoords(t.props.position);var i=this.psv.dataHelper.vector3ToViewerCoords(t.props.positions3D[0]);return i.x-=t.props.width*t.props.anchor.x,i.y-=t.props.height*t.props.anchor.y,i},h.__getPolyPositions=function(t){var i=this,e=t.props.positions3D.length,s=t.props.positions3D.map((function(t){return{vector:t,visible:t.dot(i.psv.prop.direction)>0}})),r=[];return s.forEach((function(t,i){t.visible||[0===i?s[e-1]:s[i-1],i===e-1?s[0]:s[i+1]].forEach((function(e){e.visible&&r.push({visible:e,invisible:t,index:i})}))})),r.reverse().forEach((function(t){s.splice(t.index,0,{vector:i.__getPolyIntermediaryPoint(t.visible.vector,t.invisible.vector),visible:!0})})),s.filter((function(t){return t.visible})).map((function(t){return i.psv.dataHelper.vector3ToViewerCoords(t.vector)}))},h.__getPolyIntermediaryPoint=function(t,s){var r=this.psv.prop.direction.clone().normalize(),o=(new i.Vector3).crossVectors(t,s).normalize(),n=(new i.Vector3).crossVectors(o,t).normalize(),h=t.clone().multiplyScalar(-r.dot(n)),a=n.clone().multiplyScalar(r.dot(t)),l=(new i.Vector3).addVectors(h,a).normalize(),p=(new i.Vector3).crossVectors(l,r);return l.applyAxisAngle(p,.01).multiplyScalar(e.CONSTANTS.SPHERE_RADIUS)},h.__getTargetMarker=function(t,i){void 0===i&&(i=!1);var s=i?e.utils.getClosest(t,".psv-marker"):t;return s?s.psvMarker:void 0},h.__targetOnTooltip=function(t,i){return!(!t||!i)&&e.utils.hasParent(t,i.container)},h.__onMouseEnter=function(t,i){i&&!i.isPoly()&&(this.prop.hoveringMarker=i,this.trigger(a.OVER_MARKER,i),i.props.staticTooltip||i.config.tooltip.trigger!==p||i.showTooltip(t))},h.__onMouseLeave=function(t,i){!i||i.isPoly()&&this.__targetOnTooltip(t.relatedTarget,i.tooltip)||(this.trigger(a.LEAVE_MARKER,i),this.prop.hoveringMarker=null,i.props.staticTooltip||i.config.tooltip.trigger!==p||i.hideTooltip())},h.__onMouseMove=function(t,i){var e,s;null!=i&&i.isPoly()?s=i:this.prop.hoveringMarker&&this.__targetOnTooltip(t.target,this.prop.hoveringMarker.tooltip)&&(s=this.prop.hoveringMarker),s?(this.prop.hoveringMarker||(this.trigger(a.OVER_MARKER,s),this.prop.hoveringMarker=s),s.props.staticTooltip||s.showTooltip(t)):null!=(e=this.prop.hoveringMarker)&&e.isPoly()&&(this.trigger(a.LEAVE_MARKER,this.prop.hoveringMarker),this.prop.hoveringMarker.props.staticTooltip||this.prop.hoveringMarker.hideTooltip(),this.prop.hoveringMarker=null)},h.__onClick=function(t,i,e){var s,r=null==(s=i.objects.find((function(t){return t.userData.psvMarker})))?void 0:s.userData.psvMarker;r||(r=this.__getTargetMarker(i.target,!0)),this.prop.currentMarker&&this.prop.currentMarker!==r&&(this.trigger(a.UNSELECT_MARKER,this.prop.currentMarker),this.psv.panel.hide(u),this.prop.showAllTooltips||this.prop.currentMarker.config.tooltip.trigger!==l||this.hideMarkerTooltip(this.prop.currentMarker),this.prop.currentMarker=null),r&&(this.prop.currentMarker=r,this.trigger(a.SELECT_MARKER,r,{dblclick:e,rightclick:i.rightclick}),this.config.clickEventOnMarker?i.marker=r:t.stopPropagation(),this.markers[r.id]&&(r.config.tooltip.trigger===l?r.tooltip?this.hideMarkerTooltip(r):this.showMarkerTooltip(r):this.showMarkerPanel(r.id)))},h.__refreshUi=function(){var t=Object.values(this.markers).filter((function(t){return!t.config.hideList})).length,i=this.psv.navbar.getButton(M.id,!1),e=this.psv.navbar.getButton(E.id,!1);0===t?(null==i||i.hide(),null==e||e.hide(),(this.psv.panel.isVisible(d)||this.psv.panel.isVisible(u))&&this.psv.panel.hide()):(null==i||i.show(),null==e||e.show(),this.psv.panel.isVisible(d)?this.showMarkersList():this.psv.panel.isVisible(u)&&(this.prop.currentMarker?this.showMarkerPanel(this.prop.currentMarker):this.psv.panel.hide()))},h.__checkObjectsObserver=function(){var t=Object.values(this.markers).some((function(t){return t.is3d()}));!t&&this.prop.stopObserver?(this.prop.stopObserver(),this.prop.stopObserver=null):t&&!this.prop.stopObserver&&(this.prop.stopObserver=this.psv.observeObjects(g,this))},o}(e.AbstractPlugin);S.id="markers",S.EVENTS=a,t.EVENTS=a,t.MarkersPlugin=S,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=/sm/7adcba926c1e51da75fb3b043d625103a92c1a9f4665dba402c4c3d3640f084c.map